// source: https://github.com/wachaon/browser
const mods = {
    "{55D8ED82-8B33-45B3-887E-5A1CE6E4647C}": {
        "source": "const poling = require( '/src/poling' )\r\n\r\nmodule.exports = poling",
        "path": "{browser}/index.js",
        "mapping": {
            "/src/poling": "{6FF0855B-7605-4EAA-B9DF-73490474DBB5}"
        }
    },
    "{6FF0855B-7605-4EAA-B9DF-73490474DBB5}": {
        "source": "\r\nconst { isRegExp, isNumber } = require( 'typecheck' )\r\n\r\nfunction poling ( callback, options ) {\r\n\r\n    function wait ( browser ) {\r\n        if ( isNumber( browser ) ) {\r\n            let time = Math.random() * browser\r\n            WScript.Sleep( browser / 2 + time )\r\n        } else {\r\n            while ( browser.Busy || browser.readystate != 4 ) {\r\n                WScript.Sleep(100)\r\n            }\r\n        }\r\n    }\r\n\r\n    const app = require( 'InternetExplorer.Application' )\r\n    app.Visible = !options.invisible\r\n    app.Navigate( options.home || 'about:blank' )\r\n\r\n    wait( app )\r\n\r\n    const events = new Map()\r\n    const event = {\r\n        on ( target, fn ) {\r\n            if ( events.has( target ) ) events.get( target ).push( fn )\r\n            else events.set( target, [ fn ] )\r\n        },\r\n        emit ( url, ...params ) {\r\n            events.forEach( ( callbacks, evaluation ) => {\r\n                if ( ( isRegExp( evaluation ) && evaluation.test( url ) ) || String( evaluation ) === url ) callbacks.forEach( fn => fn( url, ...params ) )\r\n            } )\r\n        }\r\n    }\r\n\r\n    let result = {}\r\n\r\n    try {\r\n        callback( app, event, result, wait )\r\n\r\n        let state = ''\r\n        console.print( 'poling' )\r\n\r\n        while ( true ) {\r\n            let backspace = '\\u001B[1G'\r\n            let display = [ '|', '/', '-', '\\\\' ]\r\n            let count = 0\r\n            console.print( display[ count++ ] )\r\n            wait( app )\r\n            let url = app.document.location.href\r\n            if ( state === url ) {\r\n                console.print( backspace + display[ count++ % 4 ] )\r\n                WScript.Sleep( 100 )\r\n                continue\r\n            }\r\n            wait( app )\r\n            event.emit( url )\r\n            state = url\r\n        }\r\n    } catch ( error ) {\r\n        console.log( '\\n' )\r\n        if ( app != null ) app.Visible = true\r\n        if ( options.exception ) options.exception( error, result, app )\r\n        else throw error\r\n    }\r\n}\r\n\r\nexports.poling = poling\r\n",
        "path": "{browser}/src/poling.js",
        "mapping": {}
    }
}
Object.keys( mods ).forEach( key => wes.Modules[ key ] = mods[ key ] )
module.exports = require( '{55D8ED82-8B33-45B3-887E-5A1CE6E4647C}' )
